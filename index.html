<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Diagnostic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap');

        body {
            background-color: #000000;
            color: #ffffff;
            font-family: 'Courier Prime', monospace;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        .text-container {
            width: 85%;
            max-width: 900px;
            text-align: center;
            margin-top: -60px;
            z-index: 10;
        }

        #typed-text {
            font-size: 1.3rem;
            line-height: 1.6;
            min-height: 5em;
            white-space: pre-wrap;
            text-shadow: 0 0 4px rgba(255, 255, 255, 0.4);
        }

        .btn-group {
            margin-top: 60px;
            display: flex;
            gap: 30px;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .system-btn {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #e5e5e5;
            padding: 15px 50px;
            font-family: 'Courier Prime', monospace;
            font-size: 1.2rem;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.2s;
        }

        .system-btn:hover {
            background: #d4d4d4;
            color: #000;
            border-color: #fff;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .system-btn:disabled {
            background: #111;
            color: #555;
            border-color: #222;
            cursor: wait;
        }

        #camera-feed {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 240px;
            height: 180px;
            background: #000;
            border: 2px solid #333;
            display: none;
            filter: grayscale(100%) brightness(0.6) contrast(1.5) sepia(20%);
            z-index: 100;
        }

        #screamer {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: #000;
            display: none;
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        #sc-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #distorted-creature {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: black;
            display: none;
            z-index: 3000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 2s ease-in;
        }
        
        #creature-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: contrast(200%) brightness(50%) hue-rotate(90deg) blur(1px);
            animation: glitch 0.2s infinite;
        }

        @keyframes glitch {
            0% { transform: translate(0) }
            20% { transform: translate(-5px, 5px) }
            40% { transform: translate(-5px, -5px) }
            60% { transform: translate(5px, 5px) }
            80% { transform: translate(5px, -5px) }
            100% { transform: translate(0) }
        }

        .cursor {
            display: inline-block;
            width: 10px;
            height: 1.2em;
            background: #ffffff;
            margin-left: 5px;
            vertical-align: middle;
            animation: blink 0.8s infinite;
        }

        @keyframes blink { 50% { opacity: 0; } }

        #progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: #111;
        }

        #progress-bar {
            height: 100%;
            width: 0%;
            background: #ffffff;
            box-shadow: 0 0 10px #fff;
            transition: width 0.5s ease, background-color 0.5s ease;
        }

        /* Language Switcher */
        #lang-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 50;
        }
        .lang-btn {
            font-size: 0.8rem;
            color: #444;
            cursor: pointer;
            transition: color 0.3s;
        }
        .lang-btn.active { color: #fff; text-decoration: underline; }
        .lang-btn:hover { color: #888; }

        /* Hidden Privacy Policy */
        #privacy-trigger {
            position: fixed;
            bottom: 10px;
            left: 10px;
            font-size: 0.6rem;
            color: #0c0c0c; 
            cursor: pointer;
            z-index: 50;
            transition: color 0.3s;
        }
        #privacy-trigger:hover { color: #222; }

        /* Privacy Modal */
        #privacy-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.98);
            display: none;
            z-index: 5000;
            padding: 40px;
            overflow-y: auto;
        }
        .modal-content {
            max-width: 800px;
            margin: 0 auto;
            font-size: 0.9rem;
            line-height: 1.4;
            color: #ccc;
            text-align: left;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="progress-container"><div id="progress-bar"></div></div>

    <div id="lang-switcher">
        <span id="btn-lang-ru" class="lang-btn active" onclick="setLang('ru')">RU</span>
        <span id="btn-lang-en" class="lang-btn" onclick="setLang('en')">EN</span>
    </div>

    <div id="privacy-trigger" onclick="togglePrivacy(true)">Privacy Policy</div>

    <div id="privacy-modal" onclick="togglePrivacy(false)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div id="privacy-content-target">
                <!-- Динамический контент политики -->
            </div>
            <button id="privacy-close-btn" class="system-btn text-xs py-2 px-4 mt-6" onclick="togglePrivacy(false)">ЗАКРЫТЬ</button>
        </div>
    </div>

    <div id="start-screen" class="text-center">
        <button id="init-button" onclick="initSystem()" class="system-btn">ВЫПОЛНИТЬ ВХОД В СИСТЕМУ</button>
        <p id="error-msg" class="text-red-600 mt-4 hidden font-mono text-sm uppercase"></p>
    </div>

    <div id="test-screen" class="text-container hidden">
        <div id="typed-text"></div><span id="cursor" class="cursor"></span>
        
        <div id="buttons" class="btn-group">
            <button id="btn-yes" onclick="handleResponse(true)" class="system-btn">ДА</button>
            <button id="btn-no" onclick="handleResponse(false)" class="system-btn">НЕТ</button>
        </div>
    </div>

    <video id="camera-feed" autoplay playsinline muted></video>

    <div id="screamer">
        <img id="sc-img" src="https://media.istockphoto.com/id/1061389024/photo/ghost-woman-in-white-shirt-horror-scene-scary-face.jpg?s=612x612&w=0&k=20&c=Qh9N5Dk3u4-Q1nI8Zq1K8K6Ym_pU9Y8t9fGz6O-v5kY=">
    </div>

    <div id="distorted-creature">
        <img id="creature-img" src="https://forums.ultra-combo.com/uploads/default/original/3X/e/f/eff4accda0c383dfa24fb3886976065dc0e18c75.jpeg">
    </div>

    <audio id="type-sound" src="https://www.soundjay.com/communication/typewriter-key-1.mp3" preload="auto"></audio>
    <audio id="scream-audio" src="https://www.myinstants.com/media/sounds/scary-scream-original-memes.mp3"></audio>
    <audio id="hum-sound" src="https://www.soundjay.com/mechanical/sounds/fluorescent-light-hum-1.mp3" loop></audio>

    <script>
        let currentIdx = 0;
        let visitorData = null;
        let typingActive = false;
        let deviationScore = 0;
        let currentLang = 'ru';

        const textElement = document.getElementById('typed-text');
        const buttons = document.getElementById('buttons');
        const typeSound = document.getElementById('type-sound');
        const progressBar = document.getElementById('progress-bar');
        const initBtn = document.getElementById('init-button');
        const errorMsg = document.getElementById('error-msg');

        const translations = {
            ru: {
                startBtn: "ВЫПОЛНИТЬ ВХОД В СИСТЕМУ",
                loading: "ПОЛУЧЕНИЕ ДОСТУПА...",
                confirmGeo: "ПОДТВЕРДИТЕ ГЕОЛОКАЦИЮ...",
                permError: "ОШИБКА: ТРЕБУЕТСЯ РАЗРЕШЕНИЕ КАМЕРЫ И ГЕОЛОКАЦИИ.",
                permAlert: "ДЛЯ ВХОДА НЕОБХОДИМО ПОДТВЕРДИТЬ ВСЕ ЗАПРОСЫ.",
                yes: "ДА",
                no: "НЕТ",
                close: "ЗАКРЫТЬ",
                finalLabel: "АНАЛИЗ ЗАВЕРШЕН. ВЫЯВЛЕНА КРИТИЧЕСКАЯ УГРОЗА.",
                detection: "СУБЪЕКТ ОБНАРУЖЕН.",
                level: "УРОВЕНЬ ПСИХОПАТИИ",
                tracking: "МЫ СЛЕДИМ ЗА ТОБОЙ.",
                privacy: `
                    <h2 class="text-xl mb-4 border-b border-gray-700 pb-2">Политика конфиденциальности</h2>
                    <div class="space-y-4 text-xs">
                        <p>Данный документ устанавливает правила взаимодействия между Системой и Субъектом. Используя ресурс, вы подтверждаете согласие.</p>
                        <h3 class="font-bold uppercase text-gray-400">1. Сбор данных</h3>
                        <p>Система осуществляет сбор биометрических данных (камера) и метаданных (IP, GPS) в реальном времени.</p>
                        <h3 class="font-bold uppercase text-gray-400">2. Ответственность</h3>
                        <p>Администрация не несет ответственности за психологические изменения Субъекта.</p>
                        <p class="italic text-gray-500">Система уже начала индексацию вашего присутствия.</p>
                    </div>
                `,
                intro: [
                    "Инициализация протокола глубокого анализа...",
                    "Установка защищенного соединения...",
                    "Биометрический захват активирован. Доступ получен.",
                    "Внимание: Любая ложь будет зафиксирована системой.",
                    "Начинаем процедуру вскрытия личности."
                ],
                questions: [
                    { q: "Вы сегодня ели?", h: false },
                    { q: "Вы часто чувствуете, что за вами наблюдают через экраны?", h: false },
                    { q: "Вы один в комнате?", h: false },
                    { q: "Вам нравится запах сырого мяса?", h: true },
                    { q: "Вы когда-нибудь желали смерти незнакомому человеку?", h: true },
                    { q: "Вы заперли входную дверь на все замки?", h: false },
                    { q: "Верите ли вы, что в темноте кто-то стоит?", h: false },
                    { q: "Вам когда-нибудь хотелось ударить кого-то просто так?", h: true },
                    { q: "Вы чувствуете себя в безопасности прямо сейчас?", h: false },
                    { q: "Вы когда-нибудь причиняли боль животным ради интереса?", h: true },
                    { q: "Вы слышите шаги в пустой квартире?", h: false },
                    { q: "Если бы вы могли убить и остаться безнаказанным, вы бы сделали это?", h: true },
                    { q: "Вас пугает ваше собственное отражение?", h: false },
                    { q: "Вы слышите голоса, когда находитесь в тишине?", h: true },
                    { q: "Вы когда-нибудь представляли, как избавляетесь от тела?", h: true },
                    { q: "Вы часто проверяете шкаф перед сном?", h: false },
                    { q: "Вы чувствуете удовлетворение, когда другие плачут?", h: true },
                    { q: "Вас посещают мысли о том, как легко сломать человеческую кость?", h: true },
                    { q: "Вы боитесь, что кто-то прочитает ваши мысли?", h: false },
                    { q: "Вы когда-нибудь пробовали собственную кровь на вкус?", h: true },
                    { q: "Вам кажется, что вы не одни в этой комнате прямо сейчас?", h: false },
                    { q: "Вы любите смотреть на огонь слишком долго?", h: false },
                    { q: "Вы хотели бы увидеть, как угасает жизнь в чужих глазах?", h: true },
                    { q: "Вы когда-нибудь воровали вещи у близких?", h: true },
                    { q: "Вы часто лжете просто чтобы посмотреть, поверят ли вам?", h: true },
                    { q: "Вы представляли свои похороны?", h: false },
                    { q: "Вас возбуждает вид крови?", h: true },
                    { q: "Вы знаете, где спрятать улики?", h: true },
                    { q: "Вы когда-нибудь чувствовали холодное дыхание на шее?", h: false },
                    { q: "Вы готовы продать душу за власть?", h: true },
                    { q: "Вы когда-нибудь хотели поджечь что-нибудь живое?", h: true },
                    { q: "Вы чувствуете себя богом, когда управляете страхом других?", h: true },
                    { q: "Вы часто думаете о том, чтобы исчезнуть навсегда?", h: false },
                    { q: "Вы чувствуете, как кто-то касается вашего плеча, когда вы спите?", h: false },
                    { q: "Вы осознаете, что этот тест — не просто игра?", h: false },
                    { q: "Вы готовы встретиться с тем, кто собирает эти данные?", h: true },
                    { q: "Вы когда-нибудь чувствовали, что ваша тень движется сама?", h: false },
                    { q: "Вы чувствуете, как кто-то заглядывает к вам в окно на 5 этаже?", h: false },
                    { q: "Вы слышите этот тихий скрежет за стеной?", h: false },
                    { q: "Вы хотите увидеть свое истинное лицо?", h: true },
                    { q: "Вы понимаете, что я уже за вашей спиной?", h: false }
                ]
            },
            en: {
                startBtn: "SIGN IN TO SYSTEM",
                loading: "ACQUIRING ACCESS...",
                confirmGeo: "CONFIRM GEOLOCATION...",
                permError: "ERROR: CAMERA AND GEOLOCATION PERMISSION REQUIRED.",
                permAlert: "YOU MUST CONFIRM ALL REQUESTS TO LOG IN.",
                yes: "YES",
                no: "NO",
                close: "CLOSE",
                finalLabel: "ANALYSIS COMPLETE. CRITICAL THREAT DETECTED.",
                detection: "SUBJECT DETECTED.",
                level: "PSYCHOPATHY LEVEL",
                tracking: "WE ARE WATCHING YOU.",
                privacy: `
                    <h2 class="text-xl mb-4 border-b border-gray-700 pb-2">Privacy Policy and Terms of Participation</h2>
                    <div class="space-y-4 text-xs">
                        <p>Please carefully review this document before using the website. By continuing to interact with the site, you confirm that you understand the nature of the project.</p>
                        <h3 class="font-bold uppercase text-gray-400">1. General Provisions</h3>
                        <p>This website is an interactive web project created for artistic, research, and experimental purposes.</p>
                        <h3 class="font-bold uppercase text-gray-400">2. Collection of Information</h3>
                        <p>The website does not collect, store, or transmit any real personal data. All interface elements are scripted.</p>
                        <h3 class="font-bold uppercase text-gray-400">3. Liability</h3>
                        <p>The site administration is not responsible for users' subjective perception of the content.</p>
                        <h3 class="font-bold uppercase text-gray-400">4. Artistic Nature</h3>
                        <p>All elements that create the impression of analysis or observation are fictional. No data is stored.</p>
                    </div>
                `,
                intro: [
                    "Initializing deep analysis protocol...",
                    "Establishing secure connection...",
                    "Biometric capture activated. Access granted.",
                    "Attention: Any lie will be recorded by the system.",
                    "Starting personality autopsy procedure."
                ],
                questions: [
                    { q: "Did you eat today?", h: false },
                    { q: "Do you often feel like you are being watched through screens?", h: false },
                    { q: "Are you alone in the room?", h: false },
                    { q: "Do you like the smell of raw meat?", h: true },
                    { q: "Have you ever wished for the death of a stranger?", h: true },
                    { q: "Did you lock your front door properly?", h: false },
                    { q: "Do you believe someone is standing in the dark?", h: false },
                    { q: "Have you ever wanted to hit someone for no reason?", h: true },
                    { q: "Do you feel safe right now?", h: false },
                    { q: "Have you ever hurt animals for fun?", h: true },
                    { q: "Do you hear footsteps in an empty house?", h: false },
                    { q: "If you could kill and go unpunished, would you?", h: true },
                    { q: "Does your own reflection scare you?", h: false },
                    { q: "Do you hear voices in complete silence?", h: true },
                    { q: "Have you ever imagined getting rid of a body?", h: true },
                    { q: "Do you often check the closet before sleep?", h: false },
                    { q: "Do feel satisfaction when others cry?", h: true },
                    { q: "Do thoughts of breaking human bones often visit you?", h: true },
                    { q: "Are you afraid someone might read your thoughts?", h: false },
                    { q: "Have you ever tasted your own blood?", h: true },
                    { q: "Does it feel like you are not alone in this room right now?", h: false },
                    { q: "Do you like staring at fire for too long?", h: false },
                    { q: "Would you like to see the life fade from someone's eyes?", h: true },
                    { q: "Have you ever stolen things from loved ones?", h: true },
                    { q: "Do you often lie just to see if they'll believe you?", h: true },
                    { q: "Have you imagined your own funeral?", h: false },
                    { q: "Does the sight of blood excite you?", h: true },
                    { q: "Do you know where to hide the evidence?", h: true },
                    { q: "Have you ever felt a cold breath on your neck?", h: false },
                    { q: "Would you sell your soul for power?", h: true },
                    { q: "Have you ever wanted to set something living on fire?", h: true },
                    { q: "Do you feel like a god when controlling others' fear?", h: true },
                    { q: "Do you often think about disappearing forever?", h: false },
                    { q: "Do you feel someone touching your shoulder when you sleep?", h: false },
                    { q: "Do you realize this test is not just a game?", h: false },
                    { q: "Are you ready to meet the one collecting this data?", h: true },
                    { q: "Have you ever felt that your shadow moves on its own?", h: false },
                    { q: "Do you feel someone looking into your window on the 5th floor?", h: false },
                    { q: "Can you hear that faint scratching behind the wall?", h: false },
                    { q: "Do you want to see your true face?", h: true },
                    { q: "Do you realize I am already behind you?", h: false }
                ]
            }
        };

        function setLang(lang) {
            currentLang = lang;
            document.getElementById('btn-lang-ru').classList.toggle('active', lang === 'ru');
            document.getElementById('btn-lang-en').classList.toggle('active', lang === 'en');
            
            initBtn.textContent = translations[lang].startBtn;
            document.getElementById('btn-yes').textContent = translations[lang].yes;
            document.getElementById('btn-no').textContent = translations[lang].no;
            document.getElementById('privacy-close-btn').textContent = translations[lang].close;
            document.getElementById('privacy-content-target').innerHTML = translations[lang].privacy;
        }

        window.onload = () => {
            setLang('ru');
            fetchIP();
        };

        function togglePrivacy(show) {
            document.getElementById('privacy-modal').style.display = show ? 'block' : 'none';
        }

        async function fetchIP() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                visitorData = await response.json();
            } catch (e) {
                visitorData = { ip: "192.168.0.X", city: "UNKNOWN", org: "SYSTEM" };
            }
        }

        async function initSystem() {
            initBtn.disabled = true;
            initBtn.textContent = translations[currentLang].loading;
            errorMsg.classList.add('hidden');

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                document.getElementById('camera-feed').srcObject = stream;

                initBtn.textContent = translations[currentLang].confirmGeo;

                if (!navigator.geolocation) throw new Error("No Geo Support");

                await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(async (pos) => {
                        try {
                            const lat = pos.coords.latitude;
                            const lon = pos.coords.longitude;
                            const geoRes = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                            const geoData = await geoRes.json();
                            if (geoData.address && visitorData) {
                                visitorData.city = geoData.address.city || geoData.address.town || visitorData.city;
                            }
                            resolve();
                        } catch(err) { resolve(); }
                    }, (err) => {
                        reject(new Error("Geo Denied"));
                    }, { enableHighAccuracy: true, timeout: 5000 });
                });
                
                setTimeout(() => {
                    document.getElementById('start-screen').classList.add('hidden');
                    document.getElementById('lang-switcher').classList.add('hidden');
                    document.getElementById('test-screen').classList.remove('hidden');
                    runIntro(0);
                }, 500);

            } catch (e) {
                initBtn.disabled = false;
                initBtn.textContent = translations[currentLang].startBtn;
                errorMsg.textContent = translations[currentLang].permError;
                errorMsg.classList.remove('hidden');
                
                const stream = document.getElementById('camera-feed').srcObject;
                if (stream) stream.getTracks().forEach(track => track.stop());
                
                alert(translations[currentLang].permAlert);
            }
        }

        function runIntro(step) {
            const lines = translations[currentLang].intro;
            if (step < lines.length) {
                typeText(lines[step], () => {
                    setTimeout(() => runIntro(step + 1), 1200);
                });
            } else {
                showQuestion();
            }
        }

        function typeText(text, callback) {
            if (typingActive) return;
            typingActive = true;
            textElement.innerHTML = "";
            buttons.style.opacity = "0";
            buttons.style.pointerEvents = "none";
            
            let i = 0;
            const timer = setInterval(() => {
                textElement.innerHTML += text.charAt(i);
                const s = typeSound.cloneNode();
                s.volume = 0.1; 
                s.play().catch(() => {});
                i++;
                if (i >= text.length) {
                    clearInterval(timer);
                    typingActive = false;
                    if (callback) callback();
                }
            }, 40);
        }

        function showQuestion() {
            const qList = translations[currentLang].questions;
            if (currentIdx < qList.length) {
                typeText(qList[currentIdx].q, () => {
                    buttons.style.opacity = "1";
                    buttons.style.pointerEvents = "auto";
                });
            } else {
                showFinal();
            }
        }

        function handleResponse(isYes) {
            if (typingActive) return;
            const qList = translations[currentLang].questions;
            
            // Логика подсчета: только ДА на жестокие вопросы увеличивает счет
            if (isYes && qList[currentIdx].h) {
                deviationScore += (100 / 25); 
                if (deviationScore > 100) deviationScore = 100;
            }
            
            // Шкала теперь отображает накопленную жестокость, а не порядковый номер вопроса
            progressBar.style.width = deviationScore + "%";
            
            currentIdx++;
            showQuestion();
        }

        function showFinal() {
            progressBar.style.width = "100%";
            progressBar.style.backgroundColor = "#ff0000";
            typeText(translations[currentLang].finalLabel, () => {
                setTimeout(() => {
                    document.getElementById('camera-feed').style.display = 'block';
                    const t = translations[currentLang];
                    const info = `
${t.detection}
--------------------------
IP: ${visitorData ? visitorData.ip : "???"}
CITY: ${visitorData ? (visitorData.city || "UNKNOWN") : "???"}
${t.level}: ${Math.round(deviationScore)}%
--------------------------
${t.tracking}
`;
                    typeText(info, () => {
                        setTimeout(triggerScreamer, 4000);
                    });
                }, 1000);
            });
        }

        function triggerScreamer() {
            const audio = document.getElementById('scream-audio');
            const hum = document.getElementById('hum-sound');
            const screamer = document.getElementById('screamer');
            const creature = document.getElementById('distorted-creature');

            screamer.style.display = 'flex';
            audio.volume = 1.0;
            audio.play().catch(() => {});
            
            try { if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen(); } catch(e) {}

            setTimeout(() => {
                screamer.style.display = 'none';
                creature.style.display = 'flex';
                setTimeout(() => creature.style.opacity = 1, 100);
                hum.volume = 1.0;
                hum.play().catch(() => {});

                setTimeout(() => {
                    document.body.innerHTML = '';
                    window.location.href = "about:blank";
                }, 5000);
            }, 3000);
        }
    </script>
</body>
</html>
